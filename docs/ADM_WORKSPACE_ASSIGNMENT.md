# Механика выдачи доступа к пространству (SUPER / SUP)

## Как это устроено

Администратору с ролью **ADM** (или **SUP** — только от SUPER) можно выдать доступ к пространству, которое создано другим пользователем. Тогда пользователь видит это пространство в своём списке «Пространства» с пометкой «Назначено» и может работать с ним (календарь, сообщения, каналы). Владелец пространства не меняется.

### Роли

- **SUPER** может назначать на пространство пользователей с ролью **ADM** или **SUP**; снимать назначение.
- **SUP** может назначать только **ADM**; снимать назначение.
- **ADM** (и назначенный **SUP**) может:
  - создавать свои пространства (как обычно);
  - видеть в списке пространств и свои, и **назначенные** (с пометкой «Назначено»);
  - **отказаться от назначения** — тогда пространство исчезнет из списка; пользователь может добавить его самостоятельно позже.

### Шаги: как SUP/SUPER выдать доступ ADM

1. **Выбрать пространство**  
   SUP/SUPER заходит на страницу нужного пространства:  
   `Дашборд → Пространства → [название пространства]`.

2. **Вкладка «Добавление пользователей»**  
   На странице пространства есть вкладка «Добавление пользователей» (если она не отключена в настройках системы). В ней можно добавлять пользователей в Rocket.Chat.  
   Отдельно от этого есть **назначение ADM на пространство в планировщике**.

3. **Назначить ADM на пространство**  
   В интерфейсе должно быть действие вида «Назначить администратора» / «Добавить ADM к пространству»: выбор пользователя с ролью ADM и сохранение.  
   Технически вызывается API:
   - **POST** `/api/admin/workspaces/[workspaceId]/assign-adm`  
   - Тело: `{ "userId": "id-пользователя-ADM" }`.  
   Только SUP и SUPER могут вызывать этот метод; пользователь с `userId` должен иметь роль ADM; пространство должно существовать и принадлежать любому пользователю.

4. **Результат**  
   В таблице `WorkspaceAdminAssignment` создаётся запись:  
   `userId` = выбранный ADM,  
   `workspaceId` = id пространства,  
   `assignedById` = id текущего SUP/SUPER.  
   При запросе списка пространств (`GET /api/workspace`) для этого ADM API возвращает и его свои пространства, и все пространства, на которые он назначен; у назначенных выставляется флаг `isAssigned: true`. В UI такие пространства показываются с бейджем «Назначено».

### Снятие доступа

- **DELETE** `/api/admin/workspaces/[workspaceId]/assign-adm`  
  Тело: `{ "userId": "id-пользователя-ADM" }`.  
  Удаляется запись из `WorkspaceAdminAssignment` — ADM больше не видит это пространство в списке.

### Где в UI вызывается назначение

На странице пространства (`/dashboard/workspaces/[id]`) для SUP и SUPER отображается блок **«Назначенные администраторы»**: список назначенных, кнопка **«Назначить»** (открывает диалог выбора пользователя) и кнопка **«Снять»** у каждой записи. SUPER может выбрать ADM или SUP; SUP — только ADM.

### Отказ от назначения

Назначенный пользователь (ADM или SUP) на странице назначенного пространства видит баннер **«Вы назначены на это пространство»** и кнопку **«Отказаться от назначения»**. При нажатии вызывается `POST /api/workspace/[id]/leave-assignment` (без тела). После этого пространство исчезает из списка пользователя; он может добавить его самостоятельно в «Пространства».

### Календарь и сообщения

- Сообщения и календарь по назначенному пространству видны всем, у кого есть доступ (владелец, назначенные ADM/SUP). VOL видит только свои сообщения.
- Синхронизация в календаре: все роли (кроме VOL) видят сообщения по своим и назначенным пространствам.

### Итог

- **SUPER или SUP** на странице пространства в блоке «Назначенные администраторы» назначает ADM (SUP — только ADM; SUPER — ADM или SUP) через `POST .../assign-adm` с `userId`.
- **Назначенный пользователь** видит пространство в списке с пометкой «Назначено», работает с календарём и сообщениями; может отказаться от назначения через кнопку на странице пространства.
